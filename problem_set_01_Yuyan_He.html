<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.24">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Professor Tiago Ventura">

<title>Text as Data: Problem Set 01</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="problem_set_01_Yuyan_He_files/libs/clipboard/clipboard.min.js"></script>
<script src="problem_set_01_Yuyan_He_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="problem_set_01_Yuyan_He_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="problem_set_01_Yuyan_He_files/libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="problem_set_01_Yuyan_He_files/libs/quarto-html/popper.min.js"></script>
<script src="problem_set_01_Yuyan_He_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="problem_set_01_Yuyan_He_files/libs/quarto-html/anchor.min.js"></script>
<link href="problem_set_01_Yuyan_He_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="problem_set_01_Yuyan_He_files/libs/quarto-html/quarto-syntax-highlighting-dc55a5b9e770e841cd82e46aadbfb9b0.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="problem_set_01_Yuyan_He_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="problem_set_01_Yuyan_He_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="problem_set_01_Yuyan_He_files/libs/bootstrap/bootstrap-9e3ffae467580fdb927a41352e75a2e0.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="fullcontent quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Text as Data: Problem Set 01</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Professor Tiago Ventura </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="instructions" class="level2">
<h2 class="anchored" data-anchor-id="instructions">Instructions</h2>
<p>To complete this homework, you have two options.</p>
<p>You can either complete this assignment using a <strong>dataset of your choice</strong>. This is a great opportunity for you to start working with a dataset that you can potentially use for your final project.</p>
<p>Your second option is to this dataset of social media posts from political candidates running for Congress during the 2022 U.S. Midterm election.</p>
<p>You can download the dataset <a href="https://www.dropbox.com/scl/fi/jz14130dlzj5xvca9txj4/midterm_candidates_labeled_all_May05.csv?rlkey=b0m1h6kk1af3uz9tjqyelthh3&amp;dl=0">here</a></p>
<p>To know more about the dataset, read and cite this paper: <a href="https://journals.sagepub.com/doi/full/10.1177/20563051251337541" class="uri">https://journals.sagepub.com/doi/full/10.1177/20563051251337541</a></p>
<p>If you want say thanks to the people who collected and shared this data with us for this class, please send a email to my colleague <a href="https://maggiegmacdonald.com/">Maggie MacDonald</a></p>
<p><strong>IMPORTANT:</strong> Remember to NOT commit your data to github. Github does not allow you to push large datasets to remote repositories. If you commit your dataset, you will need to reset your commit, and that’s always a bit of work. In addition, remember that your notebook should be compiled with the results of the code blocks.</p>
</section>
<section id="question-1" class="level2">
<h2 class="anchored" data-anchor-id="question-1">Question 1</h2>
<p>Take a small a sample of your documents and read them carefully. This sample doesn’t need to be random. Select cases that are more interesting, and close to your theoretical interest in this dataset. What are you thoughts about these documents? What did you learn after reading them?</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># loading packages</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(tidyverse,</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>               ggplot2,</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>               quanteda,</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>               tidytext,quanteda.corpora, quanteda.textstats)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'quanteda.corpora' is not available for this version of R

A version of this package for your version of R might be available elsewhere,
see the ideas at
https://cran.r-project.org/doc/manuals/r-patched/R-admin.html#Installing-packages</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: unable to access index for repository http://www.stats.ox.ac.uk/pub/RWin/bin/windows/contrib/4.5:
  cannot open URL 'http://www.stats.ox.ac.uk/pub/RWin/bin/windows/contrib/4.5/PACKAGES'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: 'BiocManager' not available.  Could not check Bioconductor.

Please use `install.packages('BiocManager')` and then retry.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in p_install(package, character.only = TRUE, ...):</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in library(package, lib.loc = lib.loc, character.only = TRUE,
logical.return = TRUE, : there is no package called 'quanteda.corpora'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in pacman::p_load(tidyverse, ggplot2, quanteda, tidytext, quanteda.corpora, : Failed to install/load:
quanteda.corpora</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read the downloaded data file</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"C:/Users/Whatsername/Desktop/TAD/PS1/midterm_candidates_labeled_all_May05.csv"</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co">#to show only 20 observations and the interesting info</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>data <span class="sc">|&gt;</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sample_n</span>(<span class="dv">20</span>) <span class="sc">|&gt;</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(text, name, platform, party_clean, office_type, office.name, gender)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                                                                                                                                                                                                                                                                                                          text
1                                                                                                                                                                                                                                                                                                  @SeanFlan45 Thank you Sean!
2                                                                 Frank proved once again that he does not represent our Jersey Values — preaching extremism, spreading lies, and pushing for radical policies. He's aligned himself with domestic terrorists and will take away a woman’s right to choose with no exceptions.
3                                                                                          Brad Christ is a strong, pragmatic conservative running in Sunset Hills, Crestwood, and Fenton. Brad is a terrific businessman and community leader who will make a great State Representative. Vote today! https://t.co/qCFvXgT3fl
4                                                                                                                                                                                                                                                            Donald Trump’s presidential bid does not shield him from the law.
5                                                                                                        The support we're seeing from across Oklahoma is overwhelming. We are building a winning coalition of Republicans, Democrats, and independents that can replace James Lankford this November. https://t.co/mBuKfjYU05
6                                                                                Initial analysis of @RepMikeTurner pre-election donations, $131K,  excluding WInRed aggregated donations (only $23K).\nAvg donation $1,642.91, 90% out of state\n45 PACS for $115K\nYour Congressman has been bought. https://t.co/ZLLsvIdzXS
7                                                                                                  BREAKING: Lexington’s Herald Leader has endorsed our campaign. This endorsement is MAJOR! Yes, the choice is very clear.\n\nJust a bit of great news to start the day. 17 days til we make history. https://t.co/oa2yW4LjWl
8                                                                                                    On #IndigenousPeoplesDay, I’m thinking about the native peoples and cultures who were the first inhabitants of this land.\n\nWe must continue doing all we can to advocate alongside our native communities and cultures.
9                                                                                                                                                         Another 5000 pieces of mail heading out this weekend. Keep an eye on your mail boxes East Cobb! 11 days and counting. Still work to be done. https://t.co/QeTpXy2SHI
10 I've called Rep. Calvert to offer my congratulations. I'd hoped for a different result, but I respect our democratic system &amp;amp; am sure that our fine election workers did their jobs honestly &amp;amp; responsibly &amp;amp; I accept the count. Thank you to everyone who voted. Full statement below: https://t.co/8BhBTJS9mZ
11                                                                                                                                                                                                                                                                     "we need to make sure we care for everyone" #paulforall
12                                                                                                                                                                                         Honored to be re-elected by the voters of Florida’s 6th Congressional District. Thank you north-central Florida. Let’s get to work!
13 Last night’s #TeamJacobs phone bank was a huge success! Big shoutout to our fantastic @ca_gop Chairwoman, Jessica @cagopchairwoman for making calls with us — and to all our amazing volunteers! \n\nReady to join us at our next phone bank? Get involved - comment below 👇 \n\n#mattjacobsforcongress #ca26 #thousandoaks
14                                                                                                    Thank you to my wife Peggy, my family, our staff, local leaders, contributors and volunteers for all the work they have done.\n\nLet’s all look forward to 2024 and do what we can to make where we live a better place.
15                                                                                                                           Nothing better than Friday Night Lights and WPIAL playoff football! Congrats to all the #PA17 teams still in the hunt for a title—and special shout out to my alma mater Bishop Canevin Football!
16                                                                                                                                                                                                                                                           What are my priorities as a senator? 📉😷🇺🇸 https://t.co/XyBnOGrwHK
17                                                                                                A beautiful weekend celebrating #Pride here in Ashland. I was one of the first U.S. Senators to support gay marriage. Today and every day, I am just as committed to protecting the fundamental right to marry who you love.
18                                                                                                                                                                                                There is no morality in oppressing women. We stand with the women and girls in Iran who are chanting “Women, Life, Freedom!”
19                                                                                                                                                                                                                                                                                        @MoneyVisCoach Isn’t she awful?  :-)
20                                                                                                                        Fort Myers is so fortunate to have Howard Sapp running to represent the interests of the people in Tallahassee. Make your plan to vote by November 8.\n\n#FL19\n#HD77\n#SWFL https://t.co/0yEJn3ivaT
                  name  platform party_clean office_type
1  Javier Garcia Ramos   Twitter  Democratic       House
2      Josh Gottheimer   Twitter  Democratic       House
3           Ann Wagner   Twitter  Republican       House
4          Adam Martin   Twitter  Democratic       House
5         Madison Horn   Twitter  Democratic      Senate
6         David Esrati   Twitter  Democratic       House
7       Charles Booker   Twitter  Democratic      Senate
8          Lucy McBath   Twitter  Democratic       House
9        Bob Christian   Twitter  Democratic       House
10        Will Rollins   Twitter  Democratic       House
11         Paul Steury   Twitter  Democratic       House
12       Michael Waltz   Twitter  Republican       House
13         Matt Jacobs Instagram  Republican       House
14        Bob Lorinser   Twitter  Democratic       House
15 Christopher Deluzio  Facebook  Democratic       House
16           Rand Paul   Twitter  Republican      Senate
17           Ron Wyden  Facebook  Democratic      Senate
18          Ilhan Omar  Facebook  Democratic       House
19        Kyle Parrish   Twitter  Democratic       House
20        Cindy Banyai   Twitter  Democratic       House
                            office.name gender
1         U.S. House Arizona District 5   Male
2      U.S. House New Jersey District 5   Male
3        U.S. House Missouri District 2 Female
4        U.S. House Oklahoma District 1   Male
5                  U.S. Senate Oklahoma Female
6           U.S. House Ohio District 10   Male
7                  U.S. Senate Kentucky   Male
8         U.S. House Georgia District 7 Female
9         U.S. House Georgia District 6   Male
10    U.S. House California District 41   Male
11        U.S. House Indiana District 2   Male
12        U.S. House Florida District 6   Male
13    U.S. House California District 26   Male
14       U.S. House Michigan District 1   Male
15  U.S. House Pennsylvania District 17   Male
16                 U.S. Senate Kentucky   Male
17                   U.S. Senate Oregon   Male
18      U.S. House Minnesota District 5 Female
19 U.S. House North Carolina District 5   Male
20       U.S. House Florida District 19 Female</code></pre>
</div>
</div>
<p>My answer:</p>
<ol type="1">
<li><p>Emoji, hashtags are widely used in these SNS posts, which takes extra steps in the pre-processing.</p></li>
<li><p>Some of the posts are not related to the mid-term election at all, while some are very much related. I wonder if there’s a certain pattern here associated to their parties or office types.</p></li>
<li><p>Since many of the posts are random in content, I could observe that there are not many repetitive vocabulary.</p></li>
</ol>
</section>
<section id="question-2" class="level2">
<h2 class="anchored" data-anchor-id="question-2">Question 2</h2>
<p>Tokenize your documents and pre-process them, removing any “extraneous” content you noticed in closely reading a sample of your documents. What content have you removed and why? Any pre-processing steps from what you saw in class that you consider not to use here?</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load packages</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(quanteda.textstats)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># convert to a corpus</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>data_corpus  <span class="ot">&lt;-</span> <span class="fu">corpus</span>(data, <span class="at">text_field=</span><span class="st">"text"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: NA is replaced by empty string</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get main bigram tokens</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Pre-process data, set ngram to 2, and the minimum count of bigrams to 10</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>t_bigram <span class="ot">&lt;-</span> <span class="fu">tokens</span>(data_corpus,</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">remove_punct =</span> <span class="cn">TRUE</span>,</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">remove_numbers=</span> <span class="cn">TRUE</span>, <span class="at">remove_url =</span> <span class="cn">TRUE</span>, <span class="at">verbose =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tokens_tolower</span>() <span class="sc">|&gt;</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tokens_remove</span>(<span class="at">pattern =</span> <span class="fu">c</span>(<span class="fu">stopwords</span>(<span class="st">"en"</span>), <span class="fu">stopwords</span>(<span class="st">"es"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tokens_remove</span>(<span class="at">pattern =</span> <span class="fu">c</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">#w+"</span>, <span class="st">"[</span><span class="sc">\\</span><span class="st">p{Emoji_Presentation}</span><span class="sc">\\</span><span class="st">p{Emoji}</span><span class="sc">\\</span><span class="st">p{So}]+"</span>, <span class="st">"[</span><span class="sc">\\</span><span class="st">p{S}]+"</span>, <span class="st">"@</span><span class="sc">\\</span><span class="st">w+"</span>), <span class="at">valuetype =</span> <span class="st">"regex"</span>) <span class="sc">|&gt;</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">textstat_collocations</span>(<span class="at">size =</span> <span class="dv">2</span>, <span class="at">min_count =</span> <span class="dv">10</span>) <span class="sc">|&gt;</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(count)) <span class="sc">|&gt;</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="do">## Select top 100 bigrams</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>)</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="co"># pre-process the original corpus, using word stem</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>t_clean <span class="ot">&lt;-</span> <span class="fu">tokens</span>(data_corpus,</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">remove_punct =</span> <span class="cn">TRUE</span>, </span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">remove_numbers=</span> <span class="cn">TRUE</span>, <span class="at">remove_url =</span> <span class="cn">TRUE</span>, <span class="at">verbose =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tokens_tolower</span>() <span class="sc">|&gt;</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tokens_remove</span>(<span class="at">pattern =</span> <span class="fu">c</span>(<span class="fu">stopwords</span>(<span class="st">"en"</span>), <span class="fu">stopwords</span>(<span class="st">"es"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tokens_remove</span>(<span class="at">pattern =</span> <span class="fu">c</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">#w+"</span>, <span class="st">"[</span><span class="sc">\\</span><span class="st">p{Emoji_Presentation}</span><span class="sc">\\</span><span class="st">p{Emoji}</span><span class="sc">\\</span><span class="st">p{So}]+"</span>, <span class="st">"[</span><span class="sc">\\</span><span class="st">p{S}]+"</span>, <span class="st">"@</span><span class="sc">\\</span><span class="st">w+"</span>), <span class="at">valuetype =</span> <span class="st">"regex"</span>) <span class="sc">|&gt;</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tokens_wordstem</span>()</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Compounding the bigram token file to the original full token file</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>tokens_combine <span class="ot">&lt;-</span> <span class="fu">tokens_compound</span>(t_clean, t_bigram)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the combined token file to dfm</span></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>data_dfm <span class="ot">&lt;-</span> tokens_combine <span class="sc">|&gt;</span> <span class="fu">dfm</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>My answer:</p>
<ol type="1">
<li><p>Besides numbers, punctuation, and stop words in both English and Spanish, I have removed website links, hashtags, and emojis, as those are not text information and are common in SNS posts.</p></li>
<li><p>I seperately run bi-grams, as I don’t see too many combining vocabulary in the sample; only including top 100 bigrams should be enough for analyzing.</p></li>
<li><p>I used word stemming to merge similar words, which I think is important in SNS posts, as many of the posts use colloquial language, and the same vocabulary can vary a lot in format.</p></li>
<li><p>I did not trim the words with extreme frequencies eventually, as SNS posts are not that repetitive in vocabulary generally, so trimming even with a very small proportion or count would remove a great number of the features.</p></li>
</ol>
</section>
<section id="question-3" class="level2">
<h2 class="anchored" data-anchor-id="question-3">Question 3</h2>
<p>Using <a href="https://github.com/matthewjdenny/preText">Danny and Spirling’s Pretext</a>, tell me which of the pre-processing steps makes a more substantive difference in the data transformation? Would you keep all these steps or would you follow the PreText recommendations? Use a sample of the data to solve this question.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(preText)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>preText: Diagnostics to Assess the Effects of Text Preprocessing Decisions
Version 0.7.2 created on 2021-07-25.
copyright (c) 2021, Matthew J. Denny, Georgetown University
                    Arthur Spirling, NYU
Type vignette('getting_started_with_preText') to get started.
Development website: https://github.com/matthewjdenny/preText</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample only 100 documents</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>corpus_100 <span class="ot">&lt;-</span> data_corpus[<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>,]</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Pre-processing</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>preprocessed_documents <span class="ot">&lt;-</span> <span class="fu">factorial_preprocessing</span>(</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    corpus_100,</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">use_ngrams =</span> <span class="cn">TRUE</span>,</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">infrequent_term_threshold =</span> <span class="fl">0.05</span>,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Preprocessing 100 documents 128 different ways...</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># perform the preText procedure</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>preText_results <span class="ot">&lt;-</span> <span class="fu">preText</span>(</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    preprocessed_documents,</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">dataset_name =</span> <span class="st">"Senator SNS"</span>,</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">distance_method =</span> <span class="st">"cosine"</span>,</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">num_comparisons =</span> <span class="dv">50</span>,</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Generating document distances...
Generating preText Scores...
Generating regression results..
The R^2 for this model is: 0.4742252 
Regression results (negative coefficients imply less risk):
                 Variable Coefficient    SE
1               Intercept       0.101 0.007
2      Remove Punctuation      -0.025 0.005
3          Remove Numbers      -0.001 0.005
4               Lowercase       0.001 0.005
5                Stemming       0.006 0.005
6        Remove Stopwords       0.019 0.005
7 Remove Infrequent Terms       0.033 0.005
8              Use NGrams      -0.008 0.005
Complete in: 21.81 seconds...</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># show the conditional effects of each preprocessing step </span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="co"># on the mean preText score for each specification</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="fu">regression_coefficient_plot</span>(preText_results,</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>                            <span class="at">remove_intercept =</span> <span class="cn">TRUE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in ggplot2::geom_point(ggplot2::aes(y = Variable, x = Coefficient), :
Ignoring unknown parameters: `linewidth`</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="problem_set_01_Yuyan_He_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>My answer:</p>
<p>I will partly follow PreText’s recommends.</p>
<ol type="1">
<li><p>Apparently removing infrequent terms has a big impact, then I may not trim, which is on the same page with my observation in the previous parts.</p></li>
<li><p>I will still remove punctuation regardless of the PreText results, as I could not imagine doing text analysis without removing punctuation. But I do wonder why removing punctuation would have such a big impact; maybe on SNS platforms, people are using punctuation in a different way.</p></li>
</ol>
</section>
<section id="question-4" class="level2">
<h2 class="anchored" data-anchor-id="question-4">Question 4</h2>
<p>Pick an important source of variation in your data (for example: date, author identity, location, etc.). Subset the data along this dimension, and discuss which words discriminate better each group. You can do this by using TF-IDF, PMI, log(share <span class="math inline">\(word_i\)</span> in group a/share <span class="math inline">\(word_i\)</span> in b), or create a measure similar to Ban’s article.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># group by party</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>dfm_grouped <span class="ot">&lt;-</span> <span class="fu">dfm_group</span>(data_dfm, party_clean)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(dfm_grouped)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Document-feature matrix of: 2 documents, 44,106 features (32.96% sparse) and 2 docvars.
            features
docs         trump fault  got kick plane happi anniversari kelley paul  i’m
  Democratic  1210    38 1918  461    35  1672         115      3  386 3985
  Republican   921    42 1495  238    36  1483          90      4  309 1951
[ reached max_nfeat ... 44,096 more features ]</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate each word share per party</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>dfm_share <span class="ot">&lt;-</span> (dfm_grouped <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">/</span> (<span class="fu">rowSums</span>(dfm_grouped) <span class="sc">+</span> <span class="fu">nfeat</span>(dfm_grouped))</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate the log ratio. If log_ratio &gt; 0, word more characteristic of Democratic</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>row1 <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(dfm_share[<span class="dv">1</span>, ])</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>row2 <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(dfm_share[<span class="dv">2</span>, ])</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>log_ratio <span class="ot">&lt;-</span> <span class="fu">log</span>(row1 <span class="sc">/</span> row2)</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the ratio number to a dataframe so we can see the top discriminate words for each party</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="do">## Positive ratio: Democratic related</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="do">## Negative ratio: Republican related </span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>log_ratio_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">word =</span> <span class="fu">featnames</span>(dfm_grouped),</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_ratio =</span> log_ratio)</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a><span class="fu">arrange</span>(log_ratio_df, <span class="fu">desc</span>(log_ratio)) <span class="sc">|&gt;</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>                 word log_ratio
1              banyai  5.581593
2            angelica  5.293911
3                  np  5.202103
4       iwillvote.com  5.046349
5              toluca  4.724378
6          anti-choic  4.555913
7             natasha  4.459685
8          loudermilk  4.428913
9          people-pow  4.353201
10              dueña  4.353201
11         schweikert  4.353201
12                jht  4.330473
13          reproduct  4.326930
14              mixon  4.318912
15 secure.actblue.com  4.307216
16             mizeur  4.221274
17                sfv  4.221274
18         harris-til  4.168630
19       nazi-support  4.084073
20            pacoima  4.069258</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">arrange</span>(log_ratio_df, log_ratio) <span class="sc">|&gt;</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>                         word log_ratio
1  scottymooreforcongress.com -5.590756
2                      scotti -5.538112
3              out-of-control -5.062689
4                  singletari -4.939456
5                         jrg -4.817566
6                    far-left -4.699783
7                     heiress -4.668034
8                       pfaff -4.649951
9                       left’ -4.517462
10           voteforlucie.com -4.517462
11                    absalom -4.479240
12                       joab -4.439500
13               soft-on-crim -4.398115
14                       nypd -4.229779
15                   santilli -4.195878
16                      ronna -4.178486
17                    wimbish -4.178486
18                      beret -4.160787
19                     la’ron -4.124419
20                  one-parti -4.037408</code></pre>
</div>
</div>
<p>My answer:</p>
<p>I want to check the word discrimination by the 2 parties, and I’m using the log ratio approach</p>
<ol type="1">
<li><p>The top discriminate words for Democratic party are name words like banyai, angelica etc. I searched among the original texts, turned out there are a few Democratic senators love to mention their own names in their posts, like “Vote for Banyai!”. Democratic senators are also in general very pro voting; we can see this from frequent mentioning in top words like “iwillvote.com”. Left-wing advocacies are among the top words as well, like abortion related “anti-choice”, and democracy related “people-powered”.</p></li>
<li><p>The top discriminate words for Republican party also include name words like “scotti”. Since during this election, Democratic party is the ruling party, many posts from the Replican party are finger pointing towards them, like the inflation/pricing is “out-of-control”, or accusing opponents being “far-left”.</p></li>
</ol>
</section>
<section id="question-5" class="level2">
<h2 class="anchored" data-anchor-id="question-5">Question 5</h2>
<p>Create a dictionary (or use a pre-existing dictionary) to measure a topic of interest in your data. It can be anything, sentiment, tone, misinformation, any topic of interest. Label your documents, and visualize the prevalence of your classes.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load dictionary related packages</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(<span class="st">"quanteda.dictionaries"</span>, <span class="st">"quanteda.sentiment"</span>)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># load a dictionary</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(data_dictionary_LSD2015)</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="co"># apply the dictionary to the dfm, calculating sentiment scores</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>lsd_results <span class="ot">&lt;-</span> data_dfm <span class="sc">|&gt;</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">textstat_polarity</span>(<span class="at">dictionary =</span> data_dictionary_LSD2015)</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a><span class="co"># get vars back</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>df_sent <span class="ot">&lt;-</span> <span class="fu">docvars</span>(data_dfm) <span class="sc">%&gt;%</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">doc_id =</span> <span class="fu">docnames</span>(data_dfm)) <span class="sc">%&gt;%</span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(lsd_results)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(doc_id)`</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># label each document per sentiment scores</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>df_sent <span class="ot">&lt;-</span> </span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(df_sent, <span class="at">sentiment_class =</span> <span class="fu">case_when</span>(</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    sentiment <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"Positive"</span>,</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    sentiment <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"Negative"</span>,</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    sentiment <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"Neutral"</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="co"># visualize each class</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(df_sent, <span class="fu">aes</span>(<span class="at">x =</span> sentiment_class, <span class="at">fill =</span> sentiment_class)) <span class="sc">+</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Prevalence of Sentiment Classes"</span>,</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Sentiment"</span>, <span class="at">y =</span> <span class="st">"Number of Documents"</span>) <span class="sc">+</span> </span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="problem_set_01_Yuyan_He_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="question-6" class="level2">
<h2 class="anchored" data-anchor-id="question-6">Question 6</h2>
<p>Pick some documents (at least 10 for each class) that are exemplar (high probability) of being for each class of your dictionary. Read these documents. Now let’s try to augment a little your classifier.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># top 10 positive</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>top_positive <span class="ot">&lt;-</span> df_sent <span class="sc">%&gt;%</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(sentiment)) <span class="sc">%&gt;%</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="co"># top 10 negative</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>top_negative <span class="ot">&lt;-</span> df_sent <span class="sc">%&gt;%</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(sentiment) <span class="sc">%&gt;%</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a><span class="co"># get docid of the top doc for each class</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>pos_ids <span class="ot">&lt;-</span> top_positive<span class="sc">$</span>doc_id</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>neg_ids <span class="ot">&lt;-</span> top_negative<span class="sc">$</span>doc_id</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a><span class="co"># subset corpus</span></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>exemplar_pos <span class="ot">&lt;-</span> <span class="fu">corpus_subset</span>(data_corpus, <span class="fu">docnames</span>(data_corpus) <span class="sc">%in%</span> pos_ids)</span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>exemplar_neg <span class="ot">&lt;-</span> <span class="fu">corpus_subset</span>(data_corpus, <span class="fu">docnames</span>(data_corpus) <span class="sc">%in%</span> neg_ids)</span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a><span class="co"># view text</span></span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a><span class="do">## exemplar positive posts</span></span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">as.character</span>(exemplar_pos))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        text5917 
"You, our volunteers, are the heart of this campaign! With incredible supporters like you taking action in every corner of the state, Team Franken knows we are going to inspire Iowans to elect Michael Franken to the U.S Senate. Thank you! Right now, we have volunteers from EVERY COUNTY reaching out to their neighbors to get out the vote! Join our Community Engagement Team today! It’s as simple as clicking on the link learning about the program, signing up and downloading a list of voters in your area: team.frankenforiowa.com The Community Engagement team is a low-input, high-impact way to make a HUGE difference for our state. When you join you'll be able to see a list of voters in your town who need a little encouragement to get out and vote. Everyone who has joined the team so far has known at least one person on their list! Start by calling the folks you know - your personal connection can make a huge difference for prospective voters. And then try giving other community members a call! We are finding that it’s a lot of fun to engage with our neighbors about the issues that matter to them. We want voter engagement to be fulfilling and accessible. This volunteer outreach can be done at your own pace, on your own time, and you can bring in friends to help! We have been taking our lists to coffee shops and asking friends to see if they know people on the list to reach out to. It’s like a scavenger hunt, and the prize at the end is the satisfaction that we did *everything* to elect incredible Democrats like Mike. Will you help?" 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       text12324 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               "📚 𝗦𝗖𝗛𝗢𝗢𝗟 𝗦𝗨𝗣𝗣𝗟𝗜𝗘𝗦 𝗗𝗘𝗟𝗜𝗩𝗘𝗥𝗘𝗗 📚 As part of my offices Annual School Supply Drive, I am happy we were able to provide these children’s books and school supplies to HONOR. They do such a great job when people need assistance the most. Thanks to the generosity of our friends and neighbors in the 99th Assembly District — the families supported by HONOR will have access to the adventures that books can bring as well as necessary school supplies to help with their education. 𝗖𝗵𝗿𝗶𝘀 𝗠𝗼𝗹𝗶𝗻𝗲𝗹𝗹𝗶, 𝗛𝗢𝗡𝗢𝗥 𝗘𝘅𝗲𝗰𝘂𝘁𝗶𝘃𝗲 𝗗𝗶𝗿𝗲𝗰𝘁𝗼𝗿 𝘀𝘁𝗮𝘁𝗲𝗱, “Thank you, Assemblyman Schmitt. This donation is appreciated and will go to good use with our residents. Thank you to all that contributed for their generosity. All of us at HONOR give thanks to the community for helping others. Thank you, again.” 𝗝𝘂𝗱𝗶𝘁𝗵 𝗖𝗶𝗼𝗹𝗶𝗻𝗼, 𝗛𝗢𝗡𝗢𝗥 𝗖𝗮𝘀𝗲 𝗠𝗮𝗻𝗮𝗴𝗲𝗿 𝘀𝘁𝗮𝘁𝗲𝗱, “We are so appreciative of this donation by Assemblyman Schmitt and the community within the 99th Assembly District. The families will benefit so much from the reading opportunity and supplies provided. Thank you, so much!”" 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       text14686 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            "Signs are going up! 32 days until the election! Keep praying! Keep believing! Keep trusting! Our God is worthy of praise! Psalm 150:1-6 Praise ye the Lord. Praise God in his sanctuary: praise him in the firmament of his power. Praise him for his mighty acts: praise him according to his excellent greatness. Praise him with the sound of the trumpet: praise him with the psaltery and harp. Praise him with the timbrel and dance: praise him with stringed instruments and organs. Praise him upon the loud cymbals: praise him upon the high sounding cymbals. Let every thing that hath breath praise the Lord. Praise ye the Lord. #bfor7thd #nicholsinnovember #godisworkingelection2022 #unitedbyfaithdividednomore" 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       text22979 
                             "Tenney reflected back to Todd’s respect for her as new staffer for former Assemblyman Dave Townsend, never knowing then that she herself would climb to the ranks of congresswoman. “When I got into the Assembly to represent Oswego which was a distinct honor, you were always so helpful dealing with some of the issues we faced then, and now that are even greater. This is a tremendous honor, and to think Oswego is going to be able to name its Public Safety Building after you. People have come from far and wide to recognize you and to honor you [on] this day, and we also want to honor you with something from Washington,” Tenney said. “We were able to get a flag flown over the U.S. Capital on your behalf. This flag was flown in your honor in dedication of the Oswego County Safety Building – In honor of Sheriff Reuel Moe Todd; and that you exemplify the true service to the community. And our community thanks you for your many years of service and your devotion to this community and everyone in Oswego. We are so grateful for your service, your hard work, your honesty and your integrity in this position and we wish you the best. And to your family, we are so grateful and thank you so much.” https://oswegocountytoday.com/news/former-oswego-county-sheriff-reuel-moe-todd-honored-in-public-safety-building-dedication/?fbclid=IwAR29YQyXBJ2TX0Ui3oSzIY18VjfdahWkMZSsA9qN5HvLkL5znLgTCaxk7DE:=:https://oswegocountytoday.com/news/former-oswego-county-sheriff-reuel-moe-todd-honored-in-public-safety-building-dedication/" 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       text26032 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 "Tyler will be speaking at Freedom Revival San Diego. Make your plans now to attend this event. The one in January was faith restoring. This event will be right before the election and will help recharge our batteries just in time for the final push. Freedom Revival and Turning Point USA Faith join to bring you a free, resource-packed experience for the whole family—sure to provide hope and inspiration for every freedom-loving individual that attends! EXPAND your resources. BUILD faith &amp; friendships. GROW your community. #tyler4congress #integrity #grassroots #revival" 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       text27548 
                                                                                                                                                                                                                                                                                                                                                            "We set out to be good and do good work in 2018, and that is precisely what we have done. Together, we built a movement from the ground up and went to work every day for the people of Coastal Virginia. We supported small businesses and working families through COVID-19, passed historic infrastructure investments, secured the largest expansion of veterans' health care in our lifetime, grew our Navy, and strengthened our military to defend our interests and allies abroad. I am immensely proud of the good work we have done to deliver for Hampton Roads and make the United States of America a better place for everyone. I chose Coastal Virginia to be home more than two decades ago, and it has been the honor of my life to represent and serve the people of Hampton Roads in Congress. Though the results were not what we wanted, I want to thank everyone for their support over the past four years. The peaceful transition of power is a cornerstone of our democracy, and I congratulate Jen Kiggans on her win and wish her success. I have instructed my team to be as helpful as possible to ensure a smooth transition and continue providing seamless constituent services to the people of Coastal Virginia." </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="do">## exemplar negative posts</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">as.character</span>(exemplar_neg))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              text5407 
                                                                                                                                                                                                                                                                                                                                                                                                                                                      "As our next Senator, I will advocate for strict penalties for violent crime, sexual assault, and domestic abuse. One of my top priorities is increasing penalties on cyber predators and those convicted of child pornography." 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             text22544 
"This is a must read; \"Crime in 2020 was 60% lower than in 1980. The crime rate began consistently declining in the early 1990s and fell every year between 2001 and 2020. Both property and violent crimes reflect this long-term trend of decreasing crime. Property crime is down 63% since 1980, and violent crime is down 33%. Property crime per 100,000 people ranged from 1,460 in New York City to 6,128 in Memphis...Violent crime decreased since 1991 in 39 states and Washington, DC. It declined by more than 60% in New Jersey, New York, Florida, and Connecticut. Meanwhile, the violent crime rate more than doubled in North Dakota, Montana, and South Dakota.\"" 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             text34808 
                                                                                                                                                  "breaking news in Dallas Texas where at least five police officers were killed when they were ambushed this was the deadliest day for U.S law enforcement since 9 11. just days after this horrific crime Mandela Barnes appeared on Vladimir Putin's propaganda news outlet and rationalized violence against American police officers police officers are over exercising their Badness this probably was a retaliatory attack do you want Mandela Barnes representing you in the Senate I'm Ron Johnson and I prove this message" 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             text65242 
                                                                                                                                                                                                                                                                                                                                                                                                             "@MollyJongFast It’s painful.\n\nI’ve lost so many people to addiction, and hearing this worry…it’s familiar and deep.\n\nThe cruelty and misguided mockery hurts people impacted by addiction—and that’s an odd choice to make, given how many Americans that includes." 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             text70323 
                                                                                                                                                                                                                                                                                                                                                                "That's where you're wrong. Torture is not the worst war crime of all. Not even close.\n\"To initiate a war of aggression, therefore, is not only an international crime; it is the supreme international crime differing only from other war crimes in that it...\"\nhttps://t.co/7riUJPgCCj https://t.co/wOG6UNhtkL" 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             text81090 
                                                                                                                                                                                                                                                                                                                                                                   "@TheOneMalsGal @laralogan Dead is dead. Probably still be here if he hadn’t been traumatized and beaten.\n\nAll those people are fucking idiots, but that’s no excuse for them being traitors. Naïve, misinformed, uneducated violent morons should be locked up, which is everyone went in the capital on Jan 6." </code></pre>
</div>
</div>
<section id="question-6.1" class="level3">
<h3 class="anchored" data-anchor-id="question-6.1">Question 6.1</h3>
<p>Using cosine similarity, grab the closest 10 documents to each reference document you read before. Read those. How well does the cosine similarity work? Try with another measure of distance. Anything interesting there?</p>
</section>
</section>
<section id="sample-from-the-original-dfm-and-trim-the-sample-for-later-similarity-calculating" class="level1">
<h1>Sample from the original dfm, and trim the sample for later similarity calculating</h1>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># extract doc_id of the exemplar documents as reference</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>exemplar_ids <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">docnames</span>(exemplar_pos), <span class="fu">docnames</span>(exemplar_neg))</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="co"># sample 5000 docs from the original dfm, excluding the exemplar docs</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>sample_ids <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(<span class="fu">docnames</span>(data_dfm), exemplar_ids) <span class="sc">|&gt;</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sample</span>(<span class="at">size =</span> <span class="dv">5000</span>)</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a><span class="co"># combine sample ids and exemplar ids</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>keep_ids <span class="ot">&lt;-</span> <span class="fu">c</span>(exemplar_ids, sample_ids)</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a><span class="co"># subset the dfm to only these docs</span></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>dfm_sample <span class="ot">&lt;-</span> data_dfm[keep_ids, ]</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a><span class="co"># trim features to further downsize the dfm sample</span></span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>dfm_sample <span class="ot">&lt;-</span> <span class="fu">dfm_trim</span>(</span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>  dfm_sample,</span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">min_docfreq =</span> <span class="fl">0.005</span>,</span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">max_docfreq =</span> <span class="fl">0.8</span>,</span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">docfreq_type =</span> <span class="st">"prop"</span></span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>) </span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a><span class="co"># use tfidf for more accurate cosine similarity calculation</span></span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a>dfm_tfidf <span class="ot">&lt;-</span> dfm_sample <span class="sc">%&gt;%</span> </span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a>                <span class="fu">dfm_tfidf</span>(<span class="at">scheme_tf =</span> <span class="st">"prop"</span>)</span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a><span class="co"># do tfidf on the reference documents (used for running similarity only for these references)</span></span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a>dfm_exemplars <span class="ot">&lt;-</span> dfm_tfidf[exemplar_ids, ]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="cosine-similarity" class="level1">
<h1>cosine similarity</h1>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="do">## compute cosine similarity for exemplar documents as reference</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>sim_exemplars <span class="ot">&lt;-</span> <span class="fu">textstat_simil</span>(dfm_tfidf,</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>                               <span class="at">x =</span> dfm_tfidf,   <span class="co"># all docs</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>                               <span class="at">y =</span> dfm_exemplars,  </span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>                               <span class="at">margin =</span> <span class="st">"documents"</span>,</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>                               <span class="at">method =</span> <span class="st">"cosine"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in textstat_simil.dfm(dfm_tfidf, x = dfm_tfidf, y = dfm_exemplars, :
'selection' is deprecated. Use 'y' instead.</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="do">## first exemplar</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>ref1 <span class="ot">&lt;-</span> exemplar_ids[<span class="dv">1</span>]</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="co"># similarity of all docs to this exemplar</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>sim_col1 <span class="ot">&lt;-</span> sim_exemplars[, ref1]</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="do">## remove self-match</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>sim_col1 <span class="ot">&lt;-</span> sim_col1[<span class="fu">names</span>(sim_col1) <span class="sc">!=</span> ref1]</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a><span class="do">## get top 10 closest docs (higher cosine value)</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>top10_ref1 <span class="ot">&lt;-</span> <span class="fu">sort</span>(sim_col1, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a><span class="do">## convert to a data frame</span></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>df_top10_ref1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">ref_doc =</span> ref1,</span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">doc_id =</span> <span class="fu">names</span>(top10_ref1),</span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">similarity =</span> <span class="fu">as.numeric</span>(top10_ref1)</span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>df_top10_ref1</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>    ref_doc     doc_id similarity
1  text5917  text13726  0.4141222
2  text5917  text44197  0.3458232
3  text5917  text27110  0.3203770
4  text5917  text30554  0.3140546
5  text5917  text14202  0.3042297
6  text5917   text2222  0.2921907
7  text5917 text121783  0.2919809
8  text5917  text19364  0.2874769
9  text5917   text4815  0.2867324
10 text5917  text87688  0.2834569</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="do">## extract from original corpus, read the closest 10 docs using cosine similarity </span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>docs_to_read <span class="ot">&lt;-</span> <span class="fu">c</span>(df_top10_ref1<span class="sc">$</span>ref_doc[<span class="dv">1</span>], df_top10_ref1<span class="sc">$</span>doc_id)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>corpus_subset <span class="ot">&lt;-</span> <span class="fu">corpus_subset</span>(data_corpus, <span class="fu">docnames</span>(data_corpus) <span class="sc">%in%</span> docs_to_read)</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="fu">as.character</span>(corpus_subset)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        text2222 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      "Meet our new super volunteer Jeromy! He’s a vet and joined our team recently. It’s so awesome having people come out that have our back!" 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        text4815 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               "Over the weekend we opened our new field office in Webster Groves. The energy was incredible. If you are looking for a yard sign or want to pitch in and volunteer, feel free to stop by and a member of our team can help you join #TeamTrudy." 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        text5917 
"You, our volunteers, are the heart of this campaign! With incredible supporters like you taking action in every corner of the state, Team Franken knows we are going to inspire Iowans to elect Michael Franken to the U.S Senate. Thank you! Right now, we have volunteers from EVERY COUNTY reaching out to their neighbors to get out the vote! Join our Community Engagement Team today! It’s as simple as clicking on the link learning about the program, signing up and downloading a list of voters in your area: team.frankenforiowa.com The Community Engagement team is a low-input, high-impact way to make a HUGE difference for our state. When you join you'll be able to see a list of voters in your town who need a little encouragement to get out and vote. Everyone who has joined the team so far has known at least one person on their list! Start by calling the folks you know - your personal connection can make a huge difference for prospective voters. And then try giving other community members a call! We are finding that it’s a lot of fun to engage with our neighbors about the issues that matter to them. We want voter engagement to be fulfilling and accessible. This volunteer outreach can be done at your own pace, on your own time, and you can bring in friends to help! We have been taking our lists to coffee shops and asking friends to see if they know people on the list to reach out to. It’s like a scavenger hunt, and the prize at the end is the satisfaction that we did *everything* to elect incredible Democrats like Mike. Will you help?" 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       text13726 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            "All hands on deck! Our volunteers and I just wrapped up a fun &amp; productive evening making phone calls to voters and assembling hundreds of lawn signs. Every bit of help matters. Want to join our team? Give us a call at (201) 783-8801 or click the link to sign up: https://pallottaforcongress.com/volunteer/" 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       text14202 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    "For our team, it's always been about our community and charity, not the politics. That's why we do “Saturdays of Service” every month year-round. I'm so proud of the volunteers on #TeamGarcia. The difference they’ve made in the last 2 years is unparalleled and it’s an honor to know them! Check out these figures!…" 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       text19364 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               "Thank you to all who have been canvassing, making calls and doing the hard work to make sure we reach every voter. This is our campaign, and we appreciate you. Mike Molesevich" 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       text27110 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      "The election countdown is on and Team Castor needs volunteers everyday through Nov 8 🙋‍♀️🙋 Join the fun and Check out the link below for more details 👇" 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       text30554 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  "Joe Kent would be a disaster for us all, and right now the only person standing in his way is me. Help us reach voters in every corner of the district by Election Day: https://secure.actblue.com/donate/mgp-2209-fr-social" 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       text44197 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       "📢 Team Kermit just knocked our 150,000 door for the season! 📢 \n\nThat means we have reached out to over 3️⃣0️⃣0️⃣,0️⃣0️⃣0️⃣ voters. \n\nToday, volunteers from all 10 counties in CA-03 went to talk to their neighbors in rain, sleet &amp; snow! \n\nThank you #TeamKermit! 💙💚🐸" 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       text87688 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             "@CynthiaZimmer14 @yoshikoherrera @RepMarkPocan @POTUS Sloppy article with a photo looking like we had a press conference. From a completely different topic. We have reached out." 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      text121783 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             "🚨 It's not over yet 🚨. @rollcall lists Don Bacon one of its 10 most vulnerable members of Congress 👉 https://t.co/1Ma7qTsQCT. \n\nYou can help:\n1️⃣ Make a plan to vote. \n2️⃣ Volunteer to connect with voters.\n3️⃣ Help family members or neighbors vote.\n\n#NE02 #votevargas #teamtony https://t.co/WFvu0e54YO" </code></pre>
</div>
</div>
<p>My answer:</p>
<ol type="1">
<li><p>Before I set seed for sampling 5000 docs from the original dfm, the most similar doc to the reference doc(text5917) I used is an extremely long doc (probably the longest post in the data set), which I suppose shares a lot of common and repetitive words with itself and with the reference doc. Therefore, after standardizing, not surprisingly it is the closest with the reference word. I think this long doc might be close to many other long and positive posts as well.</p></li>
<li><p>After setting seed, the very long doc is gone. All the other similar posts do also share a similar topic on voting and Democratic campaign. I think in general, cosine similarity seem to work well.</p></li>
</ol>
</section>
<section id="another-measure-of-distance-euclidean-distance" class="level1">
<h1>Another measure of distance: Euclidean distance</h1>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="do">## calculate Euclidean distance using the same sample dfm</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>dist_exemplars <span class="ot">&lt;-</span> <span class="fu">textstat_dist</span>(dfm_tfidf,</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>                               <span class="at">x =</span> dfm_tfidf,</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>                               <span class="at">y =</span> dfm_exemplars,  </span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>                               <span class="at">margin =</span> <span class="st">"documents"</span>,</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>                               <span class="at">method =</span> <span class="st">"euclidean"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in textstat_dist.dfm(dfm_tfidf, x = dfm_tfidf, y = dfm_exemplars, :
'selection' is deprecated. Use 'y' instead.</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="do">## still using "ref1" as the reference doc, same in calculating cosine similarity</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="do">## distance of all docs to this exemplar</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>dist_col1 <span class="ot">&lt;-</span> dist_exemplars[, ref1]        </span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="do">## remove self-match</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>dist_col1 <span class="ot">&lt;-</span> dist_col1[<span class="fu">names</span>(dist_col1) <span class="sc">!=</span> ref1]</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a><span class="do">## get top 10 closest docs (lower distance value)</span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>top10_ref1_ecld <span class="ot">&lt;-</span> <span class="fu">sort</span>(dist_col1, <span class="at">decreasing =</span> <span class="cn">FALSE</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a><span class="do">## convert to a data frame</span></span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>df_top10_ref1_ecld <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">ref_doc =</span> ref1,</span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">doc_id =</span> <span class="fu">names</span>(top10_ref1_ecld),</span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">distance =</span> <span class="fu">as.numeric</span>(top10_ref1_ecld)</span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>df_top10_ref1_ecld</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>    ref_doc     doc_id  distance
1  text5917  text92354 0.2091215
2  text5917  text51478 0.2091215
3  text5917  text66168 0.2091215
4  text5917  text32289 0.2091215
5  text5917 text125456 0.2091215
6  text5917  text97472 0.2091215
7  text5917  text45993 0.2091215
8  text5917 text112602 0.2091215
9  text5917  text92573 0.2091215
10 text5917  text26698 0.2091215</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="do">## extract from original corpus, read the closest 10 docs using Euclidean distance </span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>docs_to_read_ecld <span class="ot">&lt;-</span> <span class="fu">c</span>(df_top10_ref1_ecld<span class="sc">$</span>ref_doc[<span class="dv">1</span>], df_top10_ref1_ecld<span class="sc">$</span>doc_id)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>corpus_subset_ecld <span class="ot">&lt;-</span> <span class="fu">corpus_subset</span>(data_corpus, <span class="fu">docnames</span>(data_corpus) <span class="sc">%in%</span> docs_to_read_ecld)</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="fu">as.character</span>(corpus_subset_ecld)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        text5917 
"You, our volunteers, are the heart of this campaign! With incredible supporters like you taking action in every corner of the state, Team Franken knows we are going to inspire Iowans to elect Michael Franken to the U.S Senate. Thank you! Right now, we have volunteers from EVERY COUNTY reaching out to their neighbors to get out the vote! Join our Community Engagement Team today! It’s as simple as clicking on the link learning about the program, signing up and downloading a list of voters in your area: team.frankenforiowa.com The Community Engagement team is a low-input, high-impact way to make a HUGE difference for our state. When you join you'll be able to see a list of voters in your town who need a little encouragement to get out and vote. Everyone who has joined the team so far has known at least one person on their list! Start by calling the folks you know - your personal connection can make a huge difference for prospective voters. And then try giving other community members a call! We are finding that it’s a lot of fun to engage with our neighbors about the issues that matter to them. We want voter engagement to be fulfilling and accessible. This volunteer outreach can be done at your own pace, on your own time, and you can bring in friends to help! We have been taking our lists to coffee shops and asking friends to see if they know people on the list to reach out to. It’s like a scavenger hunt, and the prize at the end is the satisfaction that we did *everything* to elect incredible Democrats like Mike. Will you help?" 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       text26698 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         "https://danforsenate.org/2022/03/30/free-palestine-1/" 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       text32289 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       "http://Colorado.ballottrax.net:=:https://colorado.ballottrax.net/voter/" 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       text45993 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            "👊" 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       text51478 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           "#FlipThe9th https://t.co/doVIq5fI2i" 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       text66168 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              "@Paula_White Amen 👏 🙏 👏 🙏 👏" 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       text92354 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       "@drmalcolmadams https://t.co/QgsoAwFUdY" 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       text92573 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        "@JeffOnTheRight It's about to be on and crackin 🤣🤣🤣" 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       text97472 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       "https://t.co/rec3mqpRu1" 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      text112602 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         "Elizabeth Warren's Role Model https://t.co/n1ikxFLSco" 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      text125456 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          "@bennyjohnson 🤣🤣🤣" </code></pre>
</div>
</div>
<p>My answer:</p>
<ol type="1">
<li><p>The top results from Euclidean distance is very interesting: all of them are very brief posts with very little words, some times with only emojis. Since Euclidean distance is very sensitive to doc length, I suppose only the shortest posts are considered as the closest docs compared to the reference doc, which is relatively long.</p></li>
<li><p>Reviewing the full distance dataframe, I found out that there are many docs share the same Euclidean distance with the reference doc. I guess it could be that after pre-processing, a lot of the short posts were left with only 0-1 feature.</p></li>
<li><p>We can tell from the first two bullets that Euclidean distance is not a robust way to calculate doc similarity, especially not for SNS posts of which the doc length vary a great deal.</p></li>
</ol>
<section id="question-6.2" class="level3">
<h3 class="anchored" data-anchor-id="question-6.2">Question 6.2</h3>
<p>Now, check qualitative these documents. Take a look at the top features, keyword in Context, higher TF-IDF. Would you change anything in your dictionary now that you looked in these documents?</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Top features for the top10 positive and negative documents</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="do">## subset for each class</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>dfm_pos <span class="ot">&lt;-</span> dfm_sample[pos_ids, ]</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>dfm_neg <span class="ot">&lt;-</span> dfm_sample[neg_ids, ]</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="do">## read top features for positive exemplar</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a><span class="fu">topfeatures</span>(dfm_pos, <span class="at">n =</span> <span class="dv">50</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>    thank     honor communiti      help   support     peopl    famili       can 
       14        13        13        12        12        10         9         9 
     work    friend      good     everi    school     donat  district      need 
        9         8         7         7         7         7         7         6 
   provid      want      like        go      know      team    counti     proud 
        6         5         5         5         5         5         5         5 
      abl    servic     voter     great  neighbor    import     alway      join 
        5         5         5         5         5         5         4         4 
    elect    volunt  campaign      even   appreci      take     bring      make 
        4         4         4         4         4         4         4         4 
      one     state   everyon      give      year      keep      time      much 
        4         4         4         4         3         3         3         3 
     live       it’ 
        3         3 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="do">## read top features for negative exemplar</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="fu">topfeatures</span>(dfm_neg, <span class="at">n =</span> <span class="dv">50</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   crime    wrong    peopl      it’     sinc    offic      war     hate 
      15       13        7        3        3        3        3        3 
 violenc   differ    polic     news     noth american    senat      day 
       3        3        3        2        2        2        2        2 
   that’ new_york     tell   attack     mani     read   offici   impact 
       2        2        2        2        2        2        2        2 
    year      say     want    break     hard   public     much    still 
       1        1        1        1        1        1        1        1 
    just    can’t    child     hear  increas    polit    stand       u. 
       1        1        1        1        1        1        1        1 
   elect    lower   messag     even   pelosi     come      get    north 
       1        1        1        1        1        1        1        1 
   south  florida 
       1        1 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># KWIC, check for the top 10 features as key words for each class</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="do">## for positive docs</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>top_pos_words <span class="ot">&lt;-</span> <span class="fu">names</span>(<span class="fu">topfeatures</span>(dfm_pos, <span class="at">n =</span> <span class="dv">10</span>))</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>data_corpus_token <span class="ot">&lt;-</span> <span class="fu">tokens</span>(data_corpus)</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a><span class="fu">kwic</span>(data_corpus_token[pos_ids, ], <span class="at">pattern =</span> top_pos_words, <span class="at">window =</span> <span class="dv">5</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Keyword-in-context with 54 matches.                                                                          
 [text41408, 141]                           mother, so that he |   can   |
  [text12324, 31]                 books and school supplies to |  HONOR  |
  [text12324, 65]                  — the families supported by |  HONOR  |
  [text12324, 74]                 to the adventures that books |   can   |
  [text12324, 83]              as necessary school supplies to |  help   |
  [text12324, 97]                 𝗘𝘅𝗲𝗰𝘂𝘁𝗶𝘃𝗲 𝗗𝗶𝗿𝗲𝗰𝘁𝗼𝗿 𝘀𝘁𝗮𝘁𝗲𝗱, “ |  Thank  |
 [text12324, 117]                      use with our residents. |  Thank  |
 [text12324, 131]                               . All of us at |  HONOR  |
 [text12324, 141]                community for helping others. |  Thank  |
 [text12324, 189]           opportunity and supplies provided. |  Thank  |
  [text40369, 31]                 books and school supplies to |  HONOR  |
  [text40369, 65]                  — the families supported by |  HONOR  |
  [text40369, 74]                 to the adventures that books |   can   |
  [text40369, 83]              as necessary school supplies to |  help   |
  [text40369, 97]                 𝗘𝘅𝗲𝗰𝘂𝘁𝗶𝘃𝗲 𝗗𝗶𝗿𝗲𝗰𝘁𝗼𝗿 𝘀𝘁𝗮𝘁𝗲𝗱, “ |  Thank  |
 [text40369, 117]                      use with our residents. |  Thank  |
 [text40369, 131]                               . All of us at |  HONOR  |
 [text40369, 141]                community for helping others. |  Thank  |
 [text40369, 189]           opportunity and supplies provided. |  Thank  |
   [text5917, 45]                           to the U.S Senate. |  Thank  |
  [text5917, 175]              know - your personal connection |   can   |
  [text5917, 229]          accessible. This volunteer outreach |   can   |
  [text5917, 244]                            own time, and you |   can   |
  [text5917, 249]                      can bring in friends to |  help   |
  [text5917, 307]                          like Mike. Will you |  help   |
   [text37408, 4]                                    I want to |  thank  |
  [text37408, 25]                    is truly doing the Lord’s |  work   |
  [text37408, 39]                       than food, clothes and | support |
  [text37408, 62]           fostering true healing and ongoing | support |
  [text37408, 82]                 of our healthcare and social | support |
 [text37408, 142]                      N2N works and we should | support |
 [text37408, 166]                    church group for example, |   can   |
 [text37408, 178] N2N here: https://www.n2n4kc.com/donate. You |   can   |
 [text37408, 246]  https://www.n2n4kc.com/ May God bless their |  work   |
  [text27548, 10]                          be good and do good |  work   |
  [text27548, 36]                        ground up and went to |  work   |
  [text27548, 97]                  immensely proud of the good |  work   |
 [text27548, 137]                          and it has been the |  honor  |
 [text27548, 165]                            wanted, I want to |  thank  |
 [text27548, 169]                  to thank everyone for their | support |
  [text40833, 62]                  will put politics aside and |  work   |
  [text40833, 84]                     " Most importantly, Tony |   can   |
 [text40833, 117]                       . I'm proud to receive | support |
 [text40833, 158]                       . I'm proud to receive | support |
 [text40833, 186]            people-powered campaign, built on | support |
  [text26032, 38]                 before the election and will |  help   |
  [text22979, 46]                  Oswego which was a distinct |  honor  |
  [text22979, 74]                       . This is a tremendous |  honor  |
 [text22979, 106]                      to recognize you and to |  honor  |
 [text22979, 119]                          and we also want to |  honor  |
 [text22979, 154]                       flag was flown in your |  honor  |
 [text22979, 165]                  County Safety Building – In |  honor  |
 [text22979, 215]                      your service, your hard |  work   |
 [text22979, 242]                       we are so grateful and |  thank  |
                                      
 be helpful and attentive as          
 . They do such a                     
 will have access to the              
 bring as well as necessary           
 with their education. 𝗖𝗵𝗿𝗶𝘀          
 you, Assemblyman Schmitt.            
 you to all that contributed          
 give thanks to the community         
 you, again. ”                        
 you, so much!                        
 . They do such a                     
 will have access to the              
 bring as well as necessary           
 with their education. 𝗖𝗵𝗿𝗶𝘀          
 you, Assemblyman Schmitt.            
 you to all that contributed          
 give thanks to the community         
 you, again. ”                        
 you, so much!                        
 you! Right now,                      
 make a huge difference for           
 be done at your own                  
 bring in friends to help             
 ! We have been taking                
 ?                                    
 Greg Parr, Executive Director        
 helping our friends and neighbors    
 to break the habit cycle             
 . People save people,                
 system is transactional which reduces
 their mission in every way           
 coordinate a monthly cooked meal     
 sign up to volunteer on              
 .                                    
 in 2018, and that                    
 every day for the people             
 we have done to deliver              
 of my life to represent              
 everyone for their support over      
 over the past four years             
 to deliver real results for          
 be trusted to protect women's        
 from ASPIRE PAC, the                 
 from ASPIRE PAC in this              
 from voters like you.                
 recharge our batteries just in       
 , you were always so                 
 , and to think Oswego                
 you [ on ] this                      
 you with something from Washington   
 in dedication of the Oswego          
 of Sheriff Reuel Moe Todd            
 , your honesty and your              
 you so much. ”                       </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="do">## for negative docs</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>top_neg_words <span class="ot">&lt;-</span> <span class="fu">names</span>(<span class="fu">topfeatures</span>(dfm_neg, <span class="at">n =</span> <span class="dv">10</span>))</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="fu">kwic</span>(data_corpus_token[neg_ids, ], <span class="at">pattern =</span> top_neg_words, <span class="at">window =</span> <span class="dv">5</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Keyword-in-context with 31 matches.                                                                
   [text22544, 8]                        a must read;" | Crime |
  [text22544, 20]                    than in 1980. The | crime |
  [text22544, 49]   this long-term trend of decreasing | crime |
  [text22544, 52]        of decreasing crime. Property | crime |
  [text22544, 62]              since 1980, and violent | crime |
  [text22544, 69]                   down 33%. Property | crime |
  [text22544, 88]                   Memphis... Violent | crime |
 [text22544, 123]             . Meanwhile, the violent | crime |
  [text106114, 3]                      Antisemitism is | wrong |
  [text106114, 7]            is wrong. Antisemitism is | wrong |
 [text106114, 11]            is wrong. Antisemitism is | wrong |
 [text106114, 15]            is wrong. Antisemitism is | wrong |
 [text106114, 19]            is wrong. Antisemitism is | wrong |
 [text106114, 23]            is wrong. Antisemitism is | wrong |
 [text106114, 27]            is wrong. Antisemitism is | wrong |
 [text106114, 31]            is wrong. Antisemitism is | wrong |
 [text106114, 35]            is wrong. Antisemitism is | wrong |
 [text106114, 39]            is wrong. Antisemitism is | wrong |
 [text106114, 43]            is wrong. Antisemitism is | wrong |
 [text106114, 47]            is wrong. Antisemitism is | wrong |
   [text70323, 4]                  That's where you're | wrong |
  [text70323, 11]             Torture is not the worst |  war  |
  [text70323, 12]                 is not the worst war | crime |
  [text70323, 24]                     ." To initiate a |  war  |
  [text70323, 35]         is not only an international | crime |
  [text70323, 42]      it is the supreme international | crime |
  [text70323, 47]      crime differing only from other |  war  |
 [text120810, 18] difference between death threats and | hate  |
  [text34808, 36]        just days after this horrific | crime |
   [text87489, 4]                      We cannot allow | hate  |
   [text5407, 14]     for strict penalties for violent | crime |
                                     
 in 2020 was 60%                     
 rate began consistently declining in
 . Property crime is down            
 is down 63% since                   
 is down 33%.                        
 per 100,000 people ranged from      
 decreased since 1991 in 39          
 rate more than doubled in           
 . Antisemitism is wrong.            
 . Antisemitism is wrong.            
 . Antisemitism is wrong.            
 . Antisemitism is wrong.            
 . Antisemitism is wrong.            
 . Antisemitism is wrong.            
 . Antisemitism is wrong.            
 . Antisemitism is wrong.            
 . Antisemitism is wrong.            
 . Antisemitism is wrong.            
 . Antisemitism is wrong.            
 . https://t.co/ZC3l2VPXV3           
 . Torture is not the                
 crime of all. Not                   
 of all. Not even                    
 of aggression, therefore,           
 ; it is the supreme                 
 differing only from other war       
 crimes in that it.                  
 speech. Hateful tweets or           
 Mandela Barnes appeared on Vladimir 
 , violence and fear further         
 , sexual assault, and               </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Features with high tfidf scores</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="do">## subset for each class</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>dfm_pos_tfidf <span class="ot">&lt;-</span> dfm_exemplars[pos_ids, ]</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>dfm_neg_tfidf <span class="ot">&lt;-</span> dfm_exemplars[neg_ids, ]</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a><span class="do">## positive exemplar: features of higher tfidf scores</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a><span class="fu">topfeatures</span>(dfm_pos_tfidf, <span class="at">n =</span> <span class="dv">50</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>     honor  communiti        god       help     provid       keep     school 
0.30716973 0.26000858 0.25394225 0.25209515 0.25021406 0.23015774 0.22785796 
     thank      donat      everi     famili    support        abl       good 
0.21772622 0.20729761 0.20295887 0.18220332 0.18033197 0.17631507 0.16638084 
  district      peopl     friend    appreci      great   neighbor     attend 
0.16469432 0.16232793 0.16198289 0.15626956 0.14554103 0.14419771 0.14078644 
        go      trust        can     servic       work      bring      build 
0.14016706 0.13993280 0.13961503 0.13752341 0.13369503 0.13158145 0.12658167 
      sign      power  contribut     import    freedom      other      event 
0.12197649 0.11927382 0.11433514 0.11406754 0.11394873 0.11161257 0.11028888 
     elect      resid      proud       give       need      organ        act 
0.11010932 0.10915889 0.10782881 0.10592622 0.10349726 0.10043748 0.09832604 
    believ       high        let     counti       part        pac     access 
0.09489877 0.09461125 0.09461125 0.09428692 0.09377391 0.09261147 0.09223101 
      want 
0.09080312 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="do">## negative exemplar: features of higher tfidf scores</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="fu">topfeatures</span>(dfm_neg_tfidf, <span class="at">n =</span> <span class="dv">50</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>    wrong     crime     peopl       war     that’      went      hate    differ 
2.4417881 1.4894375 0.6387630 0.5346385 0.5088832 0.4507091 0.4457632 0.4285149 
  violenc      noth     still    impact   everyon       it’    offici      tell 
0.3748284 0.3428752 0.3302971 0.3234954 0.2961191 0.2741028 0.2636129 0.2359738 
   domest      sinc  prioriti     child       top   increas     advoc    attack 
0.2269340 0.2239501 0.2223582 0.2209342 0.2156636 0.2132502 0.2120920 0.2074495 
    polic      mani      read     offic     senat     close      next   help_us 
0.2067945 0.2060490 0.1974606 0.1972474 0.1900141 0.1796753 0.1679514 0.1620691 
  doesn’t       lie      news    answer     allow  new_york    remind      lost 
0.1568253 0.1562191 0.1514085 0.1499031 0.1462494 0.1455676 0.1455676 0.1454793 
 american       i’v    polici      even       say    pelosi    leader     choic 
0.1451355 0.1406426 0.1392767 0.1373065 0.1369832 0.1363080 0.1339402 0.1306894 
     hear    matter 
0.1286568 0.1272590 </code></pre>
</div>
</div>
<p>My answer: By reading features with the highest counts and tfidf scores, I feel there are a lot of words that made sense in the respective class. But when looking at those words in KWIC, words such as “like” “honor” actually are neutral or part of a proper noun, but have been captured as positive with dictionary. Similarly for negative docs, words like “crime”, “violent” are top features, but when I check for KWIC, the original post was actually talking about lower crime rate, which should be reviewed as positive. In this regard, I will consider updating the dictionary for these frequent words to increase the accuracy of dictionary on this data set.</p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>